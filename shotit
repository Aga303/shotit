#!/usr/bin/env python3

import glob
import json
import os
import sys

def description(path):
    desc_path = os.path.splitext(path)[0] + ".txt"
    with open(desc_path, 'r') as f:
        return f.read()

def main():
    rundir = sys.argv[1]
    output_file = rundir + "/" + "gallery_items.json"

    images = glob.glob(rundir + "/*.png")
    images.extend(glob.glob(rundir + "/*.gif"))
    images.extend(glob.glob(rundir + "/*.jpg"))

    gallery_items = [ { "img_path": img, "description": description(img) } for img in images ]
    print(json.dumps(gallery_items, separators=(',', ':')))
    with open(output_file, 'w') as outfile:
        json.dump(gallery_items, outfile, separators=(',', ':'))

if __name__ == "__main__":
    main()

'''
[
    {
        "img_path": Testdata1.png,
        "description": This is a test description 1
    }

    {
        "img_path": Testdata2.png,
        "description": This is a test description 2
    }

    {
        "img_path": Testdata3.png,
        "description": This is a test description 3
    }
]
'''
